version: 2

models:
  # This model will contain nulls carried through from the EPC data. You may wish to drop these for analysis
  - name: dim_households
    columns:
      - name: epc_building_reference_number
        tests:
          - unique
          - not_null
      - name: address_line_1
      - name: address_line_2
      - name: address_line_3
      - name: post_town
      - name: county
      - name: postcode
      - name: property_value_gbp
        tests:
        - dbt_expectations.expect_column_values_to_be_between:
            min_value: 0
            row_condition: "property_value_gbp is not null"
            strictly: true
      - name: total_floor_area_m2
        tests:
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              row_condition: "total_floor_area_m2 is not null"
              strictly: true
      - name: construction_year_band
      #   tests:
      #     - not_null
      #     - accepted_values:
      #         values: ['BUILT_PRE_1919', 'BUILT_1919_1944', 'BUILT_1945_1964', 'BUILT_1965_1982', 'BUILT_1983_1992', 'BUILT_1993_1999', 'BUILT_POST_1999']
      - name: has_premises_above
        tests:
          - not_null
      - name: property_type
        tests:
          - not_null
          - accepted_values:
              values: ['flat', 'house', 'bungalow', 'park home']
      - name: built_form
        tests:
          - accepted_values:
              values: ['detached', 'semi_detached', 'mid_terrace', 'end_terrace']
      - name: wall_type
        tests:
          - accepted_values:
              values: ['solid', 'cavity']
      - name: epc_rating
        tests:
          - accepted_values:
              values: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
      - name: potential_epc_rating
        tests:
          - accepted_values:
              values: ['A', 'B', 'C', 'D', 'E', 'F', 'G']
      - name: heating_system
        description:
          Derived heating system for our modelling using fuel source.
          We treat all oil/lpg/solid fuel/biomass houses as 'oil_boiler' houses in our modelling.
          main_fuel is considered first, then main_heat_fuel, then main_hotwater_fuel.
          Main sources of missingness from description cols is sap05 values and 'community scheme' heating where fuel source is unknown
        tests:
          - accepted_values:
              values: ['air_source_heat_pump', 'ground_source_heat_pump', 'gas_boiler', 'electric_boiler', 'oil_boiler']
      - name: walls_energy_efficiency
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
              quote: false
      - name: windows_energy_efficiency
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
              quote: false
      - name: roof_energy_efficiency
        description: Null if no roof (has_premises_above=True).
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
              quote: false
      - name: occupant_type
        tests:
          - accepted_values:
              values: ['owner_occupied', 'rented_private', 'rented_social']
      - name: local_authority_district_name_2020
      - name: off_gas_grid
